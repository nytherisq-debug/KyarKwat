<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>á€€á€»á€¬á€¸á€€á€½á€€á€º Â· Myanmar Traditional Draughts</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@300;400;600;700;900&family=Cinzel+Decorative:wght@400;700;900&family=Cormorant+Garamond:ital,wght@0,300;0,600;1,400&family=JetBrains+Mono:wght@300;400;600&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MYANMAR ROYAL LACQUERWARE DESIGN SYSTEM
   Inspired by: Bagan temple gold, Mandalay palace,
   Myanmar lacquerware (Yun) craftsmanship
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  /* Core palette - Bagan lacquerware */
  --void:        #050304;
  --abyss:       #080507;
  --lacquer:     #0f0b0d;
  --lacquer2:    #160d10;
  --lacquer3:    #1e1116;
  --surface:     rgba(255,220,100,0.035);
  --surface2:    rgba(255,220,100,0.06);

  /* Gold system - Shwedagon inspired */
  --gold-deep:   #7a4f0a;
  --gold-mid:    #c08020;
  --gold:        #d4962a;
  --gold-bright: #f0b93a;
  --gold-shine:  #ffd966;
  --gold-white:  #fff3c0;

  /* Crimson - Myanmar royal red */
  --ruby:        #8b1a1a;
  --ruby2:       #b52222;
  --ruby3:       #d63031;
  --ruby-glow:   rgba(214,48,49,0.4);

  /* Jade - Myanmar precious stone */
  --jade:        #1a5e3a;
  --jade2:       #22804e;
  --jade3:       #2ecc71;
  --jade-glow:   rgba(46,204,113,0.35);

  /* Text */
  --ivory:       #f8f0d8;
  --ivory2:      rgba(248,240,216,0.7);
  --ivory3:      rgba(248,240,216,0.35);
  --ivory4:      rgba(248,240,216,0.12);

  /* Board squares */
  --sq-dark:     #0a0608;
  --sq-light:    #130b10;
  --sq-border:   rgba(212,150,42,0.15);

  /* Borders */
  --border-gold: rgba(212,150,42,0.2);
  --border-gold2:rgba(212,150,42,0.08);

  /* Glow */
  --glow-gold:   rgba(212,150,42,0.3);
  --glow-gold2:  rgba(240,185,58,0.15);
}

*,*::before,*::after { margin:0; padding:0; box-sizing:border-box; }
html,body { width:100%; height:100%; overflow:hidden; }

body {
  background: var(--void);
  color: var(--ivory);
  font-family: 'Noto Sans Myanmar', 'JetBrains Mono', sans-serif;
  position: relative;
}

/* â”€â”€â”€ GLOBAL AMBIENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background:
    radial-gradient(ellipse 100% 60% at 10% 5%,  rgba(212,150,42,0.08) 0%, transparent 50%),
    radial-gradient(ellipse 70%  100% at 90% 95%, rgba(139,26,26,0.07)  0%, transparent 50%),
    radial-gradient(ellipse 80%  80%  at 50% 50%, rgba(26,94,58,0.04)   0%, transparent 60%);
}

/* Myanmar traditional pattern overlay - diagonal diamonds */
body::after {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  opacity: 0.018;
  background-image:
    repeating-conic-gradient(var(--gold) 0% 25%, transparent 0% 50%);
  background-size: 20px 20px;
  background-position: 0 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen { display:none; position:fixed; inset:0; z-index:10; }
.screen.active { display:flex; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â–‘â–‘â–‘  LOBBY SCREEN  â–‘â–‘â–‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#lobby {
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0;
  padding: 20px;
  overflow-y: auto;
}

/* Mandala background rings */
.mandala-rings {
  position: fixed; inset: 0; z-index: 0;
  display: flex; align-items: center; justify-content: center;
  pointer-events: none;
}
.mandala-rings svg {
  width: min(900px, 95vw);
  height: min(900px, 95vw);
  opacity: 0.07;
  animation: rotateMandala 60s linear infinite;
}
@keyframes rotateMandala { to { transform: rotate(360deg); } }

/* Lobby hero */
.lobby-hero {
  position: relative; z-index: 2;
  display: flex; flex-direction: column; align-items: center;
  gap: 10px;
  margin-bottom: 36px;
  animation: heroReveal 1.4s cubic-bezier(0.16,1,0.3,1) both;
}
@keyframes heroReveal {
  from { opacity:0; transform:translateY(-30px) scale(0.92); }
  to   { opacity:1; transform:none; }
}

.lobby-emblem {
  position: relative;
  width: 96px; height: 96px;
  display: flex; align-items: center; justify-content: center;
}

.lobby-emblem-ring {
  position: absolute; inset: 0;
  border-radius: 50%;
  border: 1px solid rgba(212,150,42,0.4);
  animation: emblemPulse 3s ease-in-out infinite;
}
.lobby-emblem-ring:nth-child(2) {
  inset: -8px;
  border-color: rgba(212,150,42,0.2);
  animation-delay: 0.5s;
}
.lobby-emblem-ring:nth-child(3) {
  inset: -18px;
  border-color: rgba(212,150,42,0.1);
  animation-delay: 1s;
}
@keyframes emblemPulse {
  0%,100% { transform:scale(1); opacity:1; }
  50%      { transform:scale(1.05); opacity:0.5; }
}

.lobby-emblem-inner {
  width: 64px; height: 64px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 30%, rgba(240,185,58,0.3), rgba(212,150,42,0.1) 60%, transparent);
  border: 1px solid rgba(212,150,42,0.5);
  display: flex; align-items: center; justify-content: center;
  font-size: 32px;
  box-shadow:
    0 0 30px rgba(212,150,42,0.3),
    inset 0 1px 0 rgba(255,255,255,0.1);
  animation: heroFloat 4s ease-in-out infinite;
}
@keyframes heroFloat {
  0%,100% { transform:translateY(0); }
  50%      { transform:translateY(-6px); }
}

.lobby-title {
  font-family: 'Noto Sans Myanmar', sans-serif;
  font-weight: 900;
  font-size: clamp(38px, 7vw, 68px);
  background: linear-gradient(
    160deg,
    var(--gold-deep) 0%,
    var(--gold-mid)  20%,
    var(--gold-bright) 45%,
    var(--gold-shine) 55%,
    var(--gold)      75%,
    var(--gold-deep) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 2px 24px rgba(212,150,42,0.5));
  letter-spacing: 3px;
  line-height: 1;
  margin-top: 8px;
}

.lobby-subtitle {
  font-family: 'Cinzel Decorative', serif;
  font-size: clamp(9px, 1.5vw, 12px);
  letter-spacing: 6px;
  color: var(--ivory3);
  text-transform: uppercase;
}

.lobby-ornament {
  display: flex; align-items: center; gap: 16px;
  margin: 8px 0;
}
.orn-line {
  width: 70px; height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
}
.orn-gem {
  width: 8px; height: 8px;
  background: var(--gold-bright);
  transform: rotate(45deg);
  box-shadow: 0 0 10px var(--gold-bright), 0 0 20px rgba(240,185,58,0.4);
  animation: gemSparkle 2s ease-in-out infinite;
}
.orn-dot {
  width: 4px; height: 4px;
  background: var(--gold);
  border-radius: 50%;
  animation: gemSparkle 2s ease-in-out infinite 0.3s;
}
@keyframes gemSparkle {
  0%,100% { opacity:1; transform:rotate(45deg) scale(1); }
  50%      { opacity:0.5; transform:rotate(45deg) scale(0.7); }
}

/* Lobby form card */
.lobby-card {
  position: relative; z-index: 2;
  width: min(460px, 96vw);
  background: linear-gradient(
    145deg,
    rgba(30,17,22,0.95) 0%,
    rgba(20,10,14,0.98) 100%
  );
  border: 1px solid var(--border-gold);
  border-radius: 20px;
  padding: 36px 32px;
  backdrop-filter: blur(20px);
  box-shadow:
    0 50px 100px rgba(0,0,0,0.7),
    0 0 0 1px rgba(255,255,255,0.03) inset,
    0 1px 0 rgba(212,150,42,0.3) inset,
    0 0 40px rgba(212,150,42,0.06);
  animation: cardReveal 1s cubic-bezier(0.16,1,0.3,1) 0.3s both;
}
@keyframes cardReveal {
  from { opacity:0; transform:translateY(24px) scale(0.97); }
  to   { opacity:1; transform:none; }
}

/* Gold top border glow on card */
.lobby-card::before {
  content: '';
  position: absolute; top: -1px; left: 20%; right: 20%; height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold-bright), transparent);
  border-radius: 1px;
}

.section-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  letter-spacing: 5px;
  color: var(--gold);
  text-transform: uppercase;
  margin-bottom: 16px;
  display: flex; align-items: center; gap: 10px;
}
.section-label::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, var(--border-gold), transparent);
}

.input-field {
  width: 100%;
  background: rgba(0,0,0,0.5);
  border: 1px solid var(--border-gold2);
  border-radius: 10px;
  padding: 13px 16px;
  color: var(--ivory);
  font-size: 14px;
  font-family: 'Noto Sans Myanmar', sans-serif;
  outline: none;
  transition: all 0.25s;
  margin-bottom: 12px;
}
.input-field::placeholder { color: var(--ivory4); font-size: 13px; }
.input-field:focus {
  border-color: var(--gold);
  background: rgba(212,150,42,0.07);
  box-shadow: 0 0 0 3px rgba(212,150,42,0.1), 0 0 20px rgba(212,150,42,0.08);
}
.input-field.code-style {
  font-family: 'JetBrains Mono', monospace;
  font-size: 20px;
  font-weight: 600;
  letter-spacing: 10px;
  text-align: center;
  text-transform: uppercase;
}

.btn-primary {
  width: 100%;
  padding: 14px 24px;
  border: none; border-radius: 10px;
  cursor: pointer;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px; font-weight: 600;
  letter-spacing: 4px; text-transform: uppercase;
  transition: all 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 10px;
  position: relative; overflow: hidden;
}
.btn-primary::after {
  content: '';
  position: absolute; inset: 0;
  background: rgba(255,255,255,0);
  transition: background 0.2s;
}
.btn-primary:hover::after { background: rgba(255,255,255,0.07); }
.btn-primary:active { transform: scale(0.98); }

.btn-gold-fill {
  background: linear-gradient(135deg,
    #7a4f0a 0%, #c08020 25%, #d4962a 45%,
    #f0b93a 55%, #d4962a 70%, #9a6018 100%
  );
  color: #160800;
  box-shadow:
    0 4px 20px rgba(212,150,42,0.35),
    0 1px 0 rgba(255,255,255,0.25) inset,
    0 -1px 0 rgba(0,0,0,0.3) inset;
}
.btn-gold-fill:hover {
  box-shadow:
    0 8px 30px rgba(212,150,42,0.55),
    0 1px 0 rgba(255,255,255,0.25) inset;
  transform: translateY(-1px);
}

.btn-outline-gold {
  background: transparent;
  border: 1px solid var(--border-gold);
  color: var(--ivory2);
  box-shadow: none;
}
.btn-outline-gold:hover {
  border-color: var(--gold);
  color: var(--gold-bright);
  box-shadow: 0 0 16px rgba(212,150,42,0.15);
}

.divider-row {
  display: flex; align-items: center; gap: 14px;
  margin: 20px 0;
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; letter-spacing: 4px;
  color: var(--ivory4);
}
.divider-row::before,.divider-row::after {
  content: ''; flex: 1; height: 1px;
  background: var(--border-gold2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â–‘â–‘â–‘  WAITING SCREEN  â–‘â–‘â–‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#waiting {
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 28px;
  padding: 24px;
}

.wait-logo-small {
  font-family: 'Noto Sans Myanmar', sans-serif;
  font-weight: 900; font-size: 26px;
  background: linear-gradient(135deg, var(--gold-mid), var(--gold-shine));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  letter-spacing: 3px;
}

.wait-card {
  width: min(420px, 94vw);
  background: linear-gradient(145deg, rgba(30,17,22,0.95), rgba(20,10,14,0.98));
  border: 1px solid var(--border-gold);
  border-radius: 20px;
  padding: 36px;
  text-align: center;
  backdrop-filter: blur(20px);
  box-shadow: 0 50px 100px rgba(0,0,0,0.7), 0 0 40px rgba(212,150,42,0.05);
  position: relative;
}
.wait-card::before {
  content: '';
  position: absolute; top:-1px; left:20%; right:20%; height:1px;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
}

.wait-heading {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px; letter-spacing: 5px;
  color: var(--gold); margin-bottom: 24px;
}

.room-id-display {
  background: rgba(0,0,0,0.6);
  border: 1px solid var(--border-gold);
  border-radius: 12px;
  padding: 20px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 28px; font-weight: 600;
  letter-spacing: 12px;
  color: var(--gold-shine);
  cursor: pointer;
  transition: all 0.2s;
  text-shadow: 0 0 20px rgba(240,185,58,0.5);
  margin-bottom: 8px;
  display: block;
}
.room-id-display:hover {
  border-color: var(--gold);
  background: rgba(212,150,42,0.07);
  box-shadow: 0 0 30px rgba(212,150,42,0.15);
}

.copy-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; letter-spacing: 3px;
  color: var(--ivory4); margin-bottom: 24px;
}

.myanmar-loader {
  display: flex; align-items: center; justify-content: center;
  gap: 10px; margin-bottom: 24px;
}
.myanmar-loader span {
  width: 8px; height: 8px;
  background: var(--gold);
  transform: rotate(45deg);
  animation: diamondPulse 1.6s ease-in-out infinite;
  box-shadow: 0 0 8px var(--gold);
}
.myanmar-loader span:nth-child(2) { animation-delay: 0.3s; background: var(--ruby2); }
.myanmar-loader span:nth-child(3) { animation-delay: 0.6s; }
@keyframes diamondPulse {
  0%,80%,100% { opacity:0.2; transform:rotate(45deg) scale(0.6); }
  40%         { opacity:1;   transform:rotate(45deg) scale(1.2); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â–‘â–‘â–‘  GAME SCREEN  â–‘â–‘â–‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game { display:none; position:fixed; inset:0; }
#game.active { display:flex; }

.game-layout {
  display: grid;
  grid-template-columns: 250px 1fr 300px;
  grid-template-rows: 1fr;
  width: 100%; height: 100%;
}

@media (max-width: 1100px) {
  .game-layout { grid-template-columns: 200px 1fr 0; }
  .panel-chat { display: none; }
}
@media (max-width: 700px) {
  .game-layout { grid-template-columns: 0 1fr 0; }
  .panel-info  { display: none; }
}

/* â”€â”€â”€ LEFT INFO PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.panel-info {
  background: rgba(5,3,4,0.97);
  border-right: 1px solid var(--border-gold2);
  display: flex; flex-direction: column;
  overflow: hidden; position: relative;
}

/* Decorative gold stripe */
.panel-info::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg,
    transparent 0%, var(--gold-deep) 20%,
    var(--gold-bright) 50%, var(--gold-deep) 80%, transparent 100%
  );
}

/* Myanmar pattern side decoration */
.panel-info::after {
  content: '';
  position: absolute; top: 0; bottom: 0; right: 0; width: 1px;
  background: linear-gradient(180deg,
    transparent, var(--border-gold), var(--gold), var(--border-gold), transparent
  );
}

.info-header {
  padding: 22px 20px 16px;
  border-bottom: 1px solid var(--border-gold2);
  position: relative;
}

.info-logo {
  font-family: 'Noto Sans Myanmar', sans-serif;
  font-weight: 900; font-size: 20px;
  background: linear-gradient(135deg, var(--gold-mid), var(--gold-shine));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  letter-spacing: 2px; line-height: 1.2;
}

.info-logo-en {
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px; letter-spacing: 4px;
  color: var(--ivory4);
  margin-top: 3px;
}

.info-body {
  flex: 1; overflow-y: auto; padding: 16px;
  display: flex; flex-direction: column; gap: 12px;
  scrollbar-width: none;
}
.info-body::-webkit-scrollbar { display: none; }

/* Player cards */
.player-card {
  border-radius: 14px;
  padding: 14px 14px 14px 18px;
  background: rgba(255,255,255,0.025);
  border: 1px solid var(--border-gold2);
  position: relative; overflow: hidden;
  transition: all 0.35s cubic-bezier(0.34,1.56,0.64,1);
}

/* Side accent bar */
.player-card .card-accent {
  position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
  border-radius: 14px 0 0 14px;
}
.card-white .card-accent {
  background: linear-gradient(180deg, #fff8e0, #c8b878);
}
.card-black .card-accent {
  background: linear-gradient(180deg, var(--jade2), var(--jade));
}

/* Inner glow overlay */
.player-card::before {
  content: '';
  position: absolute; inset: 0;
  opacity: 0;
  transition: opacity 0.35s;
  border-radius: 14px;
}
.card-white::before {
  background: radial-gradient(ellipse at 30% 50%, rgba(212,150,42,0.1), transparent 70%);
}
.card-black::before {
  background: radial-gradient(ellipse at 30% 50%, rgba(46,204,113,0.07), transparent 70%);
}

.player-card.is-active {
  border-color: rgba(212,150,42,0.45);
  box-shadow: 0 0 24px rgba(212,150,42,0.12), inset 0 1px 0 rgba(212,150,42,0.15);
  transform: translateX(4px);
}
.player-card.is-active::before { opacity: 1; }

.card-name {
  font-size: 13px; font-weight: 600; letter-spacing: 1px;
  color: var(--ivory); margin-bottom: 2px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.card-role {
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px; letter-spacing: 3px; color: var(--ivory4);
  margin-bottom: 10px;
}
.card-count-row {
  display: flex; align-items: baseline; gap: 6px;
}
.card-count-num {
  font-family: 'JetBrains Mono', monospace;
  font-size: 30px; font-weight: 600; line-height: 1;
  color: var(--gold-shine);
  transition: all 0.2s;
}
.card-count-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px; letter-spacing: 2px; color: var(--ivory4);
}
.card-pips {
  display: flex; flex-wrap: wrap; gap: 3px; margin-top: 8px;
}
.pip {
  width: 7px; height: 7px;
  transition: all 0.4s;
}
.pip-w {
  background: var(--ivory);
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  box-shadow: 0 0 4px rgba(255,240,192,0.5);
}
.pip-b {
  background: var(--jade3);
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  box-shadow: 0 0 4px rgba(46,204,113,0.4);
}
.pip-lost {
  background: rgba(255,255,255,0.06);
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
}

/* Status card */
.status-card {
  border-radius: 12px;
  padding: 13px 14px;
  background: rgba(255,255,255,0.02);
  border: 1px solid var(--border-gold2);
}
.status-turn-row {
  display: flex; align-items: center; gap: 8px;
  margin-bottom: 7px;
}
.status-turn-dot {
  width: 7px; height: 7px;
  background: var(--gold);
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  animation: turnDotBlink 1.2s ease-in-out infinite;
  box-shadow: 0 0 8px var(--gold);
}
@keyframes turnDotBlink {
  0%,100% { opacity:1; transform:scale(1); }
  50%      { opacity:0.2; transform:scale(0.6); }
}
.status-turn-text {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; letter-spacing: 4px; color: var(--gold);
  font-weight: 600;
}
.status-message {
  font-size: 11px; line-height: 1.65; color: var(--ivory3);
}

/* HUFF */
.huff-section { display: none; }
.huff-section.visible { display: block; }

.btn-huff {
  width: 100%; padding: 14px;
  border: none; border-radius: 12px;
  cursor: pointer;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px; font-weight: 600; letter-spacing: 3px;
  text-transform: uppercase;
  background: linear-gradient(135deg,
    #5c0a0a 0%, #8b1a1a 30%, #c0392b 55%, #e74c3c 70%, #c0392b 85%, #8b1a1a 100%
  );
  color: #fff;
  box-shadow: 0 4px 20px rgba(192,57,43,0.4);
  position: relative; overflow: hidden;
  animation: huffFlicker 2s ease-in-out infinite;
}
.btn-huff::before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.12) 0%, transparent 60%);
}
.btn-huff::after {
  content: 'âš¡';
  position: absolute; right: 16px; top: 50%; transform: translateY(-50%);
  font-size: 16px;
}
@keyframes huffFlicker {
  0%,100% { box-shadow: 0 4px 20px rgba(192,57,43,0.4), 0 0 0 0 rgba(192,57,43,0.3); }
  40%      { box-shadow: 0 6px 30px rgba(192,57,43,0.7), 0 0 0 6px rgba(192,57,43,0); }
  70%      { box-shadow: 0 4px 24px rgba(192,57,43,0.5), 0 0 0 0 rgba(192,57,43,0); }
}
.huff-note {
  margin-top: 7px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; letter-spacing: 0.5px; color: var(--ivory4);
  text-align: center; line-height: 1.6;
}

/* Footer */
.info-footer {
  padding: 14px 16px;
  border-top: 1px solid var(--border-gold2);
  display: flex; flex-direction: column; gap: 8px;
}

.room-chip {
  display: flex; align-items: center; justify-content: space-between;
  background: rgba(0,0,0,0.5);
  border: 1px solid var(--border-gold2);
  border-radius: 9px; padding: 9px 12px;
  cursor: pointer; transition: all 0.2s;
}
.room-chip:hover { border-color: var(--gold); }
.room-chip-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px; letter-spacing: 3px; color: var(--ivory4);
}
.room-chip-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 14px; font-weight: 600; letter-spacing: 5px;
  color: var(--gold-shine);
}

/* â”€â”€â”€ BOARD AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.board-area {
  display: flex; align-items: center; justify-content: center;
  background: var(--lacquer);
  position: relative; overflow: hidden;
}

/* Board area ambient glow */
.board-area::before {
  content: '';
  position: absolute; inset: 0;
  background: radial-gradient(ellipse 70% 70% at 50% 50%, rgba(212,150,42,0.05) 0%, transparent 65%);
  pointer-events: none;
}

.board-container {
  position: relative;
  padding: 28px;
}

/* Ornate frame corners - Myanmar temple style */
.board-container::before, .board-container::after,
.board-container .corner-br, .board-container .corner-bl {
  content: '';
  position: absolute;
  width: 32px; height: 32px;
  pointer-events: none;
}
.board-container::before {
  top: 8px; left: 8px;
  border-top: 2px solid var(--gold);
  border-left: 2px solid var(--gold);
  border-radius: 6px 0 0 0;
  box-shadow: -1px -1px 0 0 rgba(240,185,58,0.2);
}
.board-container::after {
  top: 8px; right: 8px;
  border-top: 2px solid var(--gold);
  border-right: 2px solid var(--gold);
  border-radius: 0 6px 0 0;
  box-shadow: 1px -1px 0 0 rgba(240,185,58,0.2);
}
.corner-br {
  bottom: 8px; right: 8px;
  border-bottom: 2px solid var(--gold);
  border-right: 2px solid var(--gold);
  border-radius: 0 0 6px 0;
}
.corner-bl {
  bottom: 8px; left: 8px;
  border-bottom: 2px solid var(--gold);
  border-left: 2px solid var(--gold);
  border-radius: 0 0 0 6px;
}

.board-frame {
  border: 2px solid rgba(212,150,42,0.3);
  border-radius: 4px;
  overflow: hidden;
  box-shadow:
    0 0 0 1px rgba(0,0,0,0.9),
    0 0 0 4px rgba(212,150,42,0.08),
    0 30px 90px rgba(0,0,0,0.8),
    0 0 60px rgba(212,150,42,0.07),
    inset 0 0 30px rgba(0,0,0,0.3);
}

#board {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  user-select: none;
}

/* â”€â”€â”€ CELLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cell {
  width:  clamp(50px, 8.5vw, 78px);
  height: clamp(50px, 8.5vw, 78px);
  display: flex; align-items: center; justify-content: center;
  position: relative;
  transition: background 0.12s;
}

.cell-light { background: var(--sq-light); }
.cell-dark  { background: var(--sq-dark); cursor: pointer; }
.cell-dark:hover { background: #120809; }

/* Selection ring */
.cell-selected {
  background: rgba(212,150,42,0.22) !important;
  box-shadow: inset 0 0 0 2px rgba(212,150,42,0.6);
}

/* Valid move indicator - subtle diamond */
.cell-move::after {
  content: '';
  position: absolute;
  width: 26%; height: 26%;
  background: rgba(46,204,113,0.65);
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  box-shadow: 0 0 12px rgba(46,204,113,0.5);
  pointer-events: none;
  animation: moveDot 1.5s ease-in-out infinite;
}
@keyframes moveDot {
  0%,100% { transform:scale(1); opacity:0.8; }
  50%      { transform:scale(1.2); opacity:1; }
}

/* Capture indicator - glowing diamond */
.cell-capture::after {
  content: '';
  position: absolute;
  width: 38%; height: 38%;
  background: rgba(214,48,49,0.75);
  clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
  box-shadow: 0 0 16px rgba(214,48,49,0.7);
  pointer-events: none;
  animation: captureDot 0.7s ease-in-out infinite alternate;
}
@keyframes captureDot {
  from { transform:scale(0.85) rotate(0deg); opacity:0.7; }
  to   { transform:scale(1.1) rotate(10deg);  opacity:1; }
}

/* â”€â”€â”€ PIECES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.piece {
  width: 72%; height: 72%;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; position: relative; z-index: 2;
  transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s;
}
.piece:hover { transform: scale(1.1) translateY(-3px); }

/* White piece - Ivory / Myanmar conch shell */
.piece-white {
  background: radial-gradient(circle at 32% 28%,
    #ffffff 0%, #f5edd0 35%, #e0d0a0 65%, #c0a860 100%
  );
  border: 2px solid rgba(255,255,255,0.5);
  box-shadow:
    0 6px 14px rgba(0,0,0,0.6),
    0 2px 4px rgba(0,0,0,0.4),
    inset 0 3px 8px rgba(255,255,255,0.75),
    inset 0 -3px 8px rgba(0,0,0,0.15),
    inset 1px 1px 0 rgba(255,255,255,0.5);
}

/* Black piece - Myanmar jade / emerald */
.piece-black {
  background: radial-gradient(circle at 32% 28%,
    #2a5040 0%, #1a3028 35%, #0d1e18 65%, #060e0b 100%
  );
  border: 2px solid rgba(46,204,113,0.2);
  box-shadow:
    0 6px 14px rgba(0,0,0,0.75),
    0 2px 4px rgba(0,0,0,0.5),
    inset 0 3px 8px rgba(46,204,113,0.15),
    inset 0 -3px 8px rgba(0,0,0,0.5),
    inset 1px 1px 0 rgba(46,204,113,0.1);
}

/* King - gold crown ring */
.piece-king::before {
  content: '';
  position: absolute; inset: -2px;
  border-radius: 50%;
  border: 2px solid var(--gold-bright);
  box-shadow:
    0 0 12px var(--gold),
    0 0 24px rgba(212,150,42,0.3),
    inset 0 0 8px rgba(212,150,42,0.2);
  animation: kingGlow 2s ease-in-out infinite;
}
@keyframes kingGlow {
  0%,100% { box-shadow: 0 0 10px var(--gold), 0 0 20px rgba(212,150,42,0.25); opacity:0.8; }
  50%      { box-shadow: 0 0 18px var(--gold-bright), 0 0 35px rgba(240,185,58,0.45); opacity:1; }
}
.piece-king::after {
  content: 'â™›';
  position: absolute;
  font-size: 38%;
  color: var(--gold-shine);
  text-shadow: 0 0 6px var(--gold);
  line-height: 1;
}

/* Huffable */
.piece-huffable {
  animation: huffable 1.3s ease-in-out infinite !important;
}
@keyframes huffable {
  0%,100% {
    box-shadow: 0 0 12px rgba(214,48,49,0.6), 0 6px 14px rgba(0,0,0,0.6), inset 0 3px 8px rgba(255,255,255,0.75);
    border-color: var(--ruby3);
  }
  50% {
    box-shadow: 0 0 28px rgba(214,48,49,1), 0 0 50px rgba(214,48,49,0.4), 0 6px 14px rgba(0,0,0,0.6), inset 0 3px 8px rgba(255,255,255,0.75);
    border-color: #ff6b6b;
  }
}

/* Selected piece lift */
.piece-selected {
  transform: scale(1.15) translateY(-5px) !important;
  z-index: 10;
}
.piece-white.piece-selected {
  box-shadow: 0 12px 28px rgba(212,150,42,0.5), inset 0 3px 8px rgba(255,255,255,0.75) !important;
}
.piece-black.piece-selected {
  box-shadow: 0 12px 28px rgba(46,204,113,0.4), inset 0 3px 8px rgba(46,204,113,0.2) !important;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â–‘â–‘â–‘  CHAT PANEL  â–‘â–‘â–‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.panel-chat {
  background: rgba(5,3,4,0.98);
  border-left: 1px solid var(--border-gold2);
  display: flex; flex-direction: column;
  position: relative; overflow: hidden;
}
.panel-chat::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg,
    transparent, var(--jade-deep, #0d3a22), var(--jade2), var(--jade3),
    var(--jade2), var(--jade-deep, #0d3a22), transparent
  );
}

.chat-header {
  padding: 16px 18px 14px;
  border-bottom: 1px solid var(--border-gold2);
  display: flex; align-items: center; gap: 12px;
}

.chat-icon-wrap {
  width: 34px; height: 34px;
  border-radius: 10px;
  background: rgba(46,204,113,0.12);
  border: 1px solid rgba(46,204,113,0.25);
  display: flex; align-items: center; justify-content: center;
  font-size: 15px; flex-shrink: 0;
}

.chat-header-info { flex: 1; }
.chat-title {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px; letter-spacing: 3px;
  color: var(--jade3); font-weight: 600;
}
.chat-subtitle {
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px; letter-spacing: 2px; color: var(--ivory4);
  margin-top: 2px;
}

.live-badge {
  display: flex; align-items: center; gap: 5px;
  background: rgba(46,204,113,0.1);
  border: 1px solid rgba(46,204,113,0.2);
  border-radius: 20px;
  padding: 3px 8px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px; letter-spacing: 2px;
  color: var(--jade3);
}
.live-dot {
  width: 5px; height: 5px; border-radius: 50%;
  background: var(--jade3);
  animation: liveBlink 1.5s ease-in-out infinite;
}
@keyframes liveBlink { 0%,100%{opacity:1;} 50%{opacity:0.2;} }

#chat-messages {
  flex: 1; overflow-y: auto; padding: 14px;
  display: flex; flex-direction: column; gap: 10px;
  scrollbar-width: thin;
  scrollbar-color: rgba(212,150,42,0.15) transparent;
}
#chat-messages::-webkit-scrollbar { width: 3px; }
#chat-messages::-webkit-scrollbar-track { background: transparent; }
#chat-messages::-webkit-scrollbar-thumb { background: rgba(212,150,42,0.18); border-radius: 2px; }

/* Chat messages */
.chat-message { animation: msgIn 0.3s cubic-bezier(0.16,1,0.3,1) both; }
@keyframes msgIn {
  from { opacity:0; transform:translateY(10px); }
  to   { opacity:1; transform:none; }
}

.chat-bubble {
  border-radius: 5px 14px 14px 14px;
  padding: 10px 14px;
  max-width: 85%;
  border: 1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.04);
}
.chat-message.is-mine .chat-bubble {
  border-radius: 14px 5px 14px 14px;
  background: rgba(46,204,113,0.09);
  border-color: rgba(46,204,113,0.18);
  margin-left: auto;
}
.chat-message.is-system {
  display: flex; justify-content: center;
}
.chat-message.is-system .chat-bubble {
  background: rgba(212,150,42,0.06);
  border-color: rgba(212,150,42,0.12);
  border-radius: 8px;
  text-align: center;
  padding: 6px 14px;
}

.chat-sender {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px; letter-spacing: 2px; font-weight: 600;
  margin-bottom: 5px;
}
.chat-message.is-mine .chat-sender { color: var(--jade3); }
.chat-message:not(.is-mine):not(.is-system) .chat-sender { color: var(--gold); }
.chat-message.is-system .chat-sender { display: none; }

.chat-text {
  font-size: 12px; line-height: 1.6; color: var(--ivory2);
  word-break: break-word;
}
.chat-message.is-system .chat-text {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px; letter-spacing: 0.5px; color: var(--ivory4);
}

.chat-time {
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px; color: var(--ivory4);
  margin-top: 4px; text-align: right;
}

/* Chat input */
.chat-input-area {
  padding: 12px 14px;
  border-top: 1px solid var(--border-gold2);
  display: flex; flex-direction: column; gap: 9px;
}

.emoji-strip {
  display: flex; gap: 5px;
}
.emoji-pill {
  background: rgba(255,255,255,0.04);
  border: 1px solid var(--border-gold2);
  border-radius: 6px; padding: 4px 8px;
  font-size: 15px; cursor: pointer;
  transition: all 0.15s; line-height: 1;
}
.emoji-pill:hover {
  background: rgba(255,255,255,0.08);
  border-color: var(--border-gold);
  transform: scale(1.12) translateY(-2px);
}

.chat-row {
  display: flex; gap: 8px; align-items: flex-end;
}
.chat-textarea {
  flex: 1;
  background: rgba(0,0,0,0.5);
  border: 1px solid var(--border-gold2);
  border-radius: 10px;
  padding: 10px 13px;
  color: var(--ivory);
  font-size: 12px;
  font-family: 'Noto Sans Myanmar', sans-serif;
  outline: none; resize: none;
  height: 42px; line-height: 1.4;
  transition: all 0.2s;
}
.chat-textarea::placeholder { color: var(--ivory4); font-size: 11px; }
.chat-textarea:focus {
  border-color: var(--jade2);
  background: rgba(46,204,113,0.04);
  box-shadow: 0 0 0 3px rgba(46,204,113,0.08);
}
.chat-send {
  width: 42px; height: 42px;
  border-radius: 10px; border: none;
  background: linear-gradient(135deg, var(--jade), var(--jade2));
  cursor: pointer; color: #fff; font-size: 15px;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; flex-shrink: 0;
  box-shadow: 0 4px 14px rgba(46,204,113,0.3);
}
.chat-send:hover {
  transform: scale(1.06) translateY(-1px);
  box-shadow: 0 6px 20px rgba(46,204,113,0.5);
}
.chat-send:active { transform: scale(0.95); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   â–‘â–‘â–‘  WIN MODAL  â–‘â–‘â–‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay {
  display: none; position: fixed; inset: 0; z-index: 300;
  background: rgba(0,0,0,0.88);
  backdrop-filter: blur(14px);
  align-items: center; justify-content: center;
}
.overlay.active { display: flex; }

.win-modal {
  width: min(400px, 92vw);
  background: linear-gradient(160deg,
    rgba(30,15,20,0.98) 0%,
    rgba(12,7,10,0.99) 100%
  );
  border: 1px solid var(--border-gold);
  border-radius: 24px;
  padding: 50px 40px;
  text-align: center;
  position: relative; overflow: hidden;
  box-shadow:
    0 80px 160px rgba(0,0,0,0.7),
    0 0 80px rgba(212,150,42,0.12);
  animation: winModalIn 0.55s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes winModalIn {
  from { opacity:0; transform:scale(0.82) translateY(24px); }
  to   { opacity:1; transform:none; }
}

/* Golden top border */
.win-modal::before {
  content: '';
  position: absolute; top: -1px; left: 15%; right: 15%; height: 1px;
  background: linear-gradient(90deg, transparent, var(--gold-shine), transparent);
}

.win-medal {
  font-size: 76px; display: block; margin-bottom: 16px;
  animation: medalFloat 3s ease-in-out infinite;
  filter: drop-shadow(0 0 20px var(--gold));
}
@keyframes medalFloat {
  0%,100% { transform:translateY(0) rotate(-4deg); }
  50%      { transform:translateY(-10px) rotate(4deg); }
}

.win-title {
  font-family: 'Cinzel Decorative', serif;
  font-size: 28px; font-weight: 900;
  background: linear-gradient(135deg, var(--gold-mid), var(--gold-shine), var(--gold-mid));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  margin-bottom: 8px;
  filter: drop-shadow(0 2px 8px rgba(212,150,42,0.4));
}

.win-subtitle {
  font-family: 'Cormorant Garamond', serif;
  font-style: italic; font-size: 16px;
  color: var(--ivory3); margin-bottom: 28px; line-height: 1.6;
}

/* â•â•â• UTILITY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@keyframes fadeUp {
  from { opacity:0; transform:translateY(12px); }
  to   { opacity:1; transform:none; }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOBBY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="lobby" class="screen active">
  <!-- Animated mandala SVG background -->
  <div class="mandala-rings">
    <svg viewBox="0 0 600 600" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Concentric decorative rings inspired by Myanmar circular patterns -->
      <circle cx="300" cy="300" r="280" stroke="#d4962a" stroke-width="0.5"/>
      <circle cx="300" cy="300" r="240" stroke="#d4962a" stroke-width="0.3"/>
      <circle cx="300" cy="300" r="200" stroke="#d4962a" stroke-width="0.5"/>
      <circle cx="300" cy="300" r="160" stroke="#d4962a" stroke-width="0.3"/>
      <!-- 8 petal pattern (Bagan temple style) -->
      <g stroke="#d4962a" stroke-width="0.5" opacity="0.8">
        <line x1="300" y1="20"  x2="300" y2="580"/>
        <line x1="20"  y1="300" x2="580" y2="300"/>
        <line x1="102" y1="102" x2="498" y2="498"/>
        <line x1="498" y1="102" x2="102" y2="498"/>
      </g>
      <!-- Diamond markers -->
      <g fill="#d4962a" opacity="0.6">
        <polygon points="300,10 308,18 300,26 292,18"/>
        <polygon points="300,574 308,582 300,590 292,582"/>
        <polygon points="10,300 18,292 26,300 18,308"/>
        <polygon points="574,300 582,292 590,300 582,308"/>
        <polygon points="95,95 103,87 111,95 103,103"/>
        <polygon points="495,95 503,87 511,95 503,103"/>
        <polygon points="95,495 103,487 111,495 103,503"/>
        <polygon points="495,495 503,487 511,495 503,503"/>
      </g>
      <!-- Inner decorative ring details -->
      <g stroke="#d4962a" stroke-width="0.3" opacity="0.4">
        <circle cx="300" cy="300" r="120"/>
        <circle cx="300" cy="300" r="80"/>
        <circle cx="300" cy="300" r="40"/>
      </g>
    </svg>
  </div>

  <div class="lobby-hero">
    <div class="lobby-emblem">
      <div class="lobby-emblem-ring"></div>
      <div class="lobby-emblem-ring"></div>
      <div class="lobby-emblem-ring"></div>
      <div class="lobby-emblem-inner">â™Ÿ</div>
    </div>
    <h1 class="lobby-title">á€€á€»á€¬á€¸á€€á€½á€€á€º</h1>
    <p class="lobby-subtitle">Myanmar Traditional Draughts</p>
    <div class="lobby-ornament">
      <div class="orn-dot"></div>
      <div class="orn-line"></div>
      <div class="orn-gem"></div>
      <div class="orn-line"></div>
      <div class="orn-dot"></div>
    </div>
  </div>

  <div class="lobby-card">
    <div class="section-label">á€€á€…á€¬á€¸á€á€° á€¡á€á€»á€€á€ºá€¡á€œá€€á€º</div>
    <input type="text" class="input-field" id="player-name" placeholder="á€á€„á€ºá á€¡á€™á€Šá€º Â· Your Name" maxlength="22">
    <button class="btn-primary btn-gold-fill" onclick="createGame()">
      <span>âœ¦</span>&nbsp; NEW GAME &nbsp;<span>âœ¦</span>
    </button>
    <div class="divider-row">or join</div>
    <input type="text" class="input-field code-style" id="join-game-id" placeholder="ROOM ID" maxlength="6">
    <button class="btn-primary btn-outline-gold" onclick="joinGame()">
      JOIN EXISTING GAME â†’
    </button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     WAITING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="waiting" class="screen" style="flex-direction:column;align-items:center;justify-content:center;gap:28px;padding:24px;">
  <div class="mandala-rings"></div>

  <div style="position:relative;z-index:2;text-align:center;">
    <div style="font-size:40px;margin-bottom:8px;display:block;filter:drop-shadow(0 0 16px var(--gold));animation:heroFloat 4s ease-in-out infinite;">â™Ÿ</div>
    <div class="wait-logo-small">á€€á€»á€¬á€¸á€€á€½á€€á€º</div>
  </div>

  <div class="wait-card" style="position:relative;z-index:2;">
    <div class="wait-heading">â³ &nbsp; WAITING FOR OPPONENT</div>
    <div class="room-id-display" id="display-game-id" onclick="copyGameId()">â€”â€”</div>
    <div class="copy-label">ğŸ“‹ &nbsp; Click to copy Â· á€™á€­á€á€ºá€†á€½á€±á€€á€­á€¯ á€•á€±á€¸á€•á€­á€¯á€·á€•á€«</div>
    <div class="myanmar-loader">
      <span></span><span></span><span></span>
    </div>
    <button class="btn-primary btn-outline-gold" style="width:auto;padding:10px 28px;margin:0 auto;display:flex;" onclick="backToLobby()">
      â† CANCEL
    </button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GAME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="game" class="screen">
  <div class="game-layout">

    <!-- â”€â”€ INFO PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="panel-info">
      <div class="info-header">
        <div class="info-logo">á€€á€»á€¬á€¸á€€á€½á€€á€º</div>
        <div class="info-logo-en">MYANMAR TRADITIONAL DRAUGHTS</div>
      </div>

      <div class="info-body">

        <!-- White Player -->
        <div class="player-card card-white" id="card-white">
          <div class="card-accent"></div>
          <div class="card-name" id="name-white">White</div>
          <div class="card-role">WHITE Â· á€–á€¼á€° Â· IVORY</div>
          <div class="card-count-row">
            <div class="card-count-num" id="count-white">12</div>
            <div class="card-count-label">&nbsp;PIECES</div>
          </div>
          <div class="card-pips" id="pips-white"></div>
        </div>

        <!-- Black Player -->
        <div class="player-card card-black" id="card-black">
          <div class="card-accent"></div>
          <div class="card-name" id="name-black">Black</div>
          <div class="card-role">BLACK Â· á€™á€Šá€ºá€¸ Â· JADE</div>
          <div class="card-count-row">
            <div class="card-count-num" id="count-black">12</div>
            <div class="card-count-label">&nbsp;PIECES</div>
          </div>
          <div class="card-pips" id="pips-black"></div>
        </div>

        <!-- Status -->
        <div class="status-card">
          <div class="status-turn-row">
            <div class="status-turn-dot" id="turn-dot"></div>
            <div class="status-turn-text" id="turn-label">LOADING...</div>
          </div>
          <div class="status-message" id="status-msg">Connecting to game server...</div>
        </div>

        <!-- HUFF Section -->
        <div class="huff-section" id="huff-section">
          <button class="btn-huff" onclick="doHuff()">âš¡ &nbsp; HUFF THE PIECE</button>
          <div class="huff-note">
            á€™á€–á€™á€ºá€¸á€˜á€² á€›á€½á€±á€·á€á€½á€¬á€¸á€á€²á€· piece á€€á€­á€¯ á€–á€šá€ºá€›á€¾á€¬á€¸á€•á€«<br>
            Opponent failed to capture Â· Remove their piece
          </div>
        </div>

      </div>

      <div class="info-footer">
        <div class="room-chip" onclick="copyGameId()">
          <div class="room-chip-label">ROOM ID</div>
          <div class="room-chip-value" id="room-id-chip">â€”â€”</div>
          <div style="font-size:10px;opacity:0.3;">ğŸ“‹</div>
        </div>
        <button class="btn-primary btn-outline-gold" style="font-size:9px;padding:9px;letter-spacing:3px;" onclick="backToLobby()">
          â† LEAVE GAME
        </button>
      </div>
    </div>

    <!-- â”€â”€ BOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="board-area">
      <div class="board-container">
        <div class="corner-br"></div>
        <div class="corner-bl"></div>
        <div class="board-frame">
          <div id="board"></div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ CHAT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="panel-chat">
      <div class="chat-header">
        <div class="chat-icon-wrap">ğŸ’¬</div>
        <div class="chat-header-info">
          <div class="chat-title">LIVE CHAT</div>
          <div class="chat-subtitle">á€‚á€­á€™á€ºá€¸á€¡á€á€½á€„á€ºá€¸ á€…á€€á€¬á€¸á€•á€¼á€±á€¬</div>
        </div>
        <div class="live-badge">
          <div class="live-dot"></div> LIVE
        </div>
      </div>

      <div id="chat-messages"></div>

      <div class="chat-input-area">
        <div class="emoji-strip">
          <button class="emoji-pill" onclick="addEmoji('ğŸ˜„')">ğŸ˜„</button>
          <button class="emoji-pill" onclick="addEmoji('ğŸ‘')">ğŸ‘</button>
          <button class="emoji-pill" onclick="addEmoji('ğŸ˜¤')">ğŸ˜¤</button>
          <button class="emoji-pill" onclick="addEmoji('ğŸ˜ˆ')">ğŸ˜ˆ</button>
          <button class="emoji-pill" onclick="addEmoji('ğŸ’€')">ğŸ’€</button>
          <button class="emoji-pill" onclick="addEmoji('ğŸ”¥')">ğŸ”¥</button>
          <button class="emoji-pill" onclick="addEmoji('ğŸ†')">ğŸ†</button>
        </div>
        <div class="chat-row">
          <textarea class="chat-textarea" id="chat-input"
            placeholder="Message Â· á€…á€¬á€•á€­á€¯á€¸..."
            maxlength="120" rows="1"
            onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendChat();}">
          </textarea>
          <button class="chat-send" onclick="sendChat()">â¤</button>
        </div>
      </div>
    </div>

  </div><!-- end game-layout -->
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     WIN MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="win-overlay">
  <div class="win-modal">
    <span class="win-medal" id="win-medal">ğŸ†</span>
    <div class="win-title" id="win-title">VICTORY</div>
    <div class="win-subtitle" id="win-subtitle">You have conquered the board!</div>
    <button class="btn-primary btn-gold-fill" onclick="backToLobby()" style="max-width:220px;margin:0 auto;">
      âŸ³ &nbsp; PLAY AGAIN
    </button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FIREBASE + GAME LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue, push, serverTimestamp }
  from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

/* â”€â”€ Firebase init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const app = initializeApp({
  apiKey:            "AIzaSyC-LM-rRPfgxIlYH9fpuZwUkSCCOPidg5g",
  authDomain:        "kyarkwat-57298.firebaseapp.com",
  databaseURL:       "https://kyarkwat-57298-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:         "kyarkwat-57298",
  storageBucket:     "kyarkwat-57298.firebasestorage.app",
  messagingSenderId: "143473069573",
  appId:             "1:143473069573:web:127d6c9320195f10afd66c"
});
const db = getDatabase(app);

/* â”€â”€ Game state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let gameId    = null;
let myColor   = null;   // 'white' | 'black'
let myName    = '';
let gameRef   = null;
let chatRef   = null;
let unsubGame = null;
let unsubChat = null;

let board           = [];      // [8][8]  null | {color, king, id}
let currentTurn     = 'white';
let huffablePiece   = null;    // {row,col} | null
let selectedCell    = null;    // {row,col} | null
let validMoves      = [];      // [{row,col,type,capturedFirst,...}]
let gameOver        = false;
let forcedCaptures  = [];      // [{r,c,paths,maxCaptures}]
let chainCapture    = null;    // {row,col} | null   â€” piece mid-chain
let prevCounts      = { white:12, black:12 };

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOARD INITIALIZATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initBoard() {
  board = Array(8).fill(null).map(() => Array(8).fill(null));
  let wi = 0, bi = 0;
  for (let r = 0; r < 8; r++) {
    for (let c = 0; c < 8; c++) {
      if (isDark(r, c)) {
        if (r < 3)      board[r][c] = { color: 'black', king: false, id: 'b' + bi++ };
        else if (r > 4) board[r][c] = { color: 'white', king: false, id: 'w' + wi++ };
      }
    }
  }
}

function isDark(r, c) { return (r + c) % 2 === 1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOVE ENGINE â€” 100% accurate Myanmar rules
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/** Simple (non-capture) moves for piece at (r,c) on board b */
function getSimpleMoves(r, c, b = board) {
  const p = b[r][c];
  if (!p) return [];
  const moves = [];

  if (p.king) {
    // King: slides diagonally any distance
    for (const [dr, dc] of [[-1,-1],[-1,1],[1,-1],[1,1]]) {
      let nr = r + dr, nc = c + dc;
      while (inBounds(nr, nc)) {
        if (!b[nr][nc]) moves.push({ row: nr, col: nc, type: 'move', path: [] });
        else break;
        nr += dr; nc += dc;
      }
    }
  } else {
    // Pawn: forward only
    const dir = p.color === 'white' ? -1 : 1;
    for (const dc of [-1, 1]) {
      const nr = r + dir, nc = c + dc;
      if (inBounds(nr, nc) && !b[nr][nc])
        moves.push({ row: nr, col: nc, type: 'move', path: [] });
    }
  }
  return moves;
}

function inBounds(r, c) { return r >= 0 && r < 8 && c >= 0 && c < 8; }

/**
 * Recursive capture path finder.
 * Returns array of capture paths; each path is array of
 * { captured:{r,c}, landRow, landCol }
 */
function findCapturePaths(r, c, piece, visited, tb) {
  const dirs = [[-1,-1],[-1,1],[1,-1],[1,1]];
  const all = [];

  for (const [dr, dc] of dirs) {

    if (piece.king) {
      // King: slide to find an opponent, then land anywhere beyond
      let nr = r + dr, nc = c + dc;
      while (inBounds(nr, nc)) {
        const t = tb[nr][nc];
        if (t) {
          if (t.color !== piece.color) {
            const ck = `${nr},${nc}`;
            if (!visited.has(ck)) {
              let lr = nr + dr, lc = nc + dc;
              while (inBounds(lr, lc) && !tb[lr][lc]) {
                const nb  = deepCopy(tb);
                const mp  = { ...nb[r][c] };
                nb[r][c]  = null;
                nb[nr][nc]= null;
                nb[lr][lc]= mp;
                const nv  = new Set(visited); nv.add(ck);
                const sub = findCapturePaths(lr, lc, mp, nv, nb);

                if (!sub.length) {
                  all.push([{ captured: { r: nr, c: nc }, landRow: lr, landCol: lc }]);
                } else {
                  for (const s of sub)
                    all.push([{ captured: { r: nr, c: nc }, landRow: lr, landCol: lc }, ...s]);
                }
                lr += dr; lc += dc;
              }
            }
          }
          break; // blocked
        }
        nr += dr; nc += dc;
      }
    } else {
      // Pawn: jump exactly one opponent
      const mr = r + dr, mc = c + dc;
      const lr = r + 2*dr, lc = c + 2*dc;
      if (!inBounds(mr, mc) || !inBounds(lr, lc)) continue;
      const t = tb[mr][mc];
      if (t && t.color !== piece.color && !tb[lr][lc]) {
        const ck = `${mr},${mc}`;
        if (!visited.has(ck)) {
          const nb  = deepCopy(tb);
          const mp  = { ...nb[r][c] };
          nb[r][c]  = null;
          nb[mr][mc]= null;
          nb[lr][lc]= mp;
          // Promotion during chain
          if ((mp.color === 'white' && lr === 0) || (mp.color === 'black' && lr === 7))
            nb[lr][lc].king = true;
          const nv  = new Set(visited); nv.add(ck);
          const sub = findCapturePaths(lr, lc, nb[lr][lc], nv, nb);

          if (!sub.length) {
            all.push([{ captured: { r: mr, c: mc }, landRow: lr, landCol: lc }]);
          } else {
            for (const s of sub)
              all.push([{ captured: { r: mr, c: mc }, landRow: lr, landCol: lc }, ...s]);
          }
        }
      }
    }
  }
  return all;
}

function deepCopy(b) { return b.map(row => row.map(c => c ? { ...c } : null)); }

/** Best (maximum) capture paths for piece at (r,c) */
function bestCapturePaths(r, c, b = board) {
  const p = b[r][c];
  if (!p) return [];
  const paths = findCapturePaths(r, c, p, new Set(), deepCopy(b));
  if (!paths.length) return [];
  const mx = Math.max(...paths.map(p => p.length));
  return paths.filter(p => p.length === mx);
}

/** All pieces of color that MUST capture (max capture rule) */
function computeForcedCaptures(color) {
  const candidates = [];
  for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++) {
    if (board[r][c]?.color === color) {
      const paths = bestCapturePaths(r, c);
      if (paths.length) candidates.push({ r, c, paths, maxCaptures: paths[0].length });
    }
  }
  if (!candidates.length) return [];
  const globalMax = Math.max(...candidates.map(x => x.maxCaptures));
  return candidates.filter(x => x.maxCaptures === globalMax);
}

/** Convert capture paths into first-step clickable moves */
function movesFromPaths(paths) {
  const seen = new Set(), out = [];
  for (const path of paths) {
    const f   = path[0];
    const key = `${f.landRow},${f.landCol}`;
    if (!seen.has(key)) {
      seen.add(key);
      out.push({
        row:          f.landRow,
        col:          f.landCol,
        type:         'capture',
        path,
        capturedFirst: f.captured
      });
    }
  }
  return out;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderBoard() {
  const el = document.getElementById('board');
  el.innerHTML = '';

  const validSet   = new Set();
  const captureSet = new Set();
  for (const m of validMoves) {
    (m.type === 'capture' ? captureSet : validSet).add(`${m.row},${m.col}`);
  }

  for (let r = 0; r < 8; r++) {
    for (let c = 0; c < 8; c++) {
      const cell = document.createElement('div');
      cell.className = 'cell ' + (isDark(r, c) ? 'cell-dark' : 'cell-light');

      const key   = `${r},${c}`;
      const isSel = (selectedCell && selectedCell.row === r && selectedCell.col === c)
                 || (chainCapture  && chainCapture.row  === r && chainCapture.col  === c);

      if      (isSel)              cell.classList.add('cell-selected');
      else if (captureSet.has(key)) cell.classList.add('cell-capture');
      else if (validSet.has(key))   cell.classList.add('cell-move');

      const piece = board[r][c];
      if (piece) {
        const p = document.createElement('div');
        p.className = 'piece '
          + (piece.color === 'white' ? 'piece-white' : 'piece-black')
          + (piece.king ? ' piece-king' : '');
        if (huffablePiece && huffablePiece.row === r && huffablePiece.col === c)
          p.classList.add('piece-huffable');
        if (isSel)
          p.classList.add('piece-selected');
        cell.appendChild(p);
      }

      cell.addEventListener('click', () => handleCellClick(r, c));
      el.appendChild(cell);
    }
  }

  updateCounters();
  updatePips();
  updateActiveTurnCards();
}

function updateCounters() {
  let w = 0, b = 0;
  for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++) {
    if (board[r][c]) { board[r][c].color === 'white' ? w++ : b++; }
  }
  const we = document.getElementById('count-white');
  const be = document.getElementById('count-black');
  we.textContent = w;
  be.textContent = b;
  if (w < prevCounts.white) flashEl(we);
  if (b < prevCounts.black) flashEl(be);
  prevCounts = { white: w, black: b };
}

function flashEl(el) {
  el.style.cssText = 'color:#e74c3c;transform:scale(1.4);transition:color .15s,transform .15s;';
  setTimeout(() => { el.style.cssText = ''; }, 500);
}

function updatePips() {
  let w = 0, b = 0;
  for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++) {
    if (board[r][c]) { board[r][c].color === 'white' ? w++ : b++; }
  }
  const make = (count, color, id) => {
    const el = document.getElementById(id);
    el.innerHTML = '';
    for (let i = 0; i < 12; i++) {
      const d = document.createElement('div');
      d.className = 'pip ' + (i < count ? 'pip-' + color : 'pip-lost');
      el.appendChild(d);
    }
  };
  make(w, 'w', 'pips-white');
  make(b, 'b', 'pips-black');
}

function updateActiveTurnCards() {
  document.getElementById('card-white').classList.toggle('is-active', currentTurn === 'white');
  document.getElementById('card-black').classList.toggle('is-active', currentTurn === 'black');
}

function updateStatus() {
  const tl  = document.getElementById('turn-label');
  const sm  = document.getElementById('status-msg');
  const huf = document.getElementById('huff-section');
  const dot = document.getElementById('turn-dot');

  if (gameOver) {
    tl.textContent = 'GAME OVER';
    sm.textContent = '';
    huf.classList.remove('visible');
    return;
  }

  const isMine = currentTurn === myColor;
  tl.textContent = isMine ? 'YOUR TURN Â· á€á€„á€·á€ºá€¡á€œá€¾á€Šá€·á€º' : 'OPPONENT TURN';
  dot.style.background = isMine ? 'var(--gold)' : 'var(--jade3)';

  if (huffablePiece && isMine) {
    huf.classList.add('visible');
    sm.textContent = 'HUFF available! Remove or make your move.';
  } else {
    huf.classList.remove('visible');
    if      (chainCapture)       sm.textContent = 'Chain capture! Continue capturing.';
    else if (isMine && forcedCaptures.length)
      sm.textContent = `âš  MUST CAPTURE! Max ${forcedCaptures[0].maxCaptures} piece(s).`;
    else if (isMine)             sm.textContent = 'Select a piece to move.';
    else                         sm.textContent = 'Waiting for opponent...';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTERACTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleCellClick(r, c) {
  if (gameOver || currentTurn !== myColor) return;

  // â”€â”€ Chain capture in progress â”€â”€
  if (chainCapture) {
    const vm = validMoves.find(m => m.row === r && m.col === c);
    if (vm) executeCapture(chainCapture.row, chainCapture.col, vm);
    return;
  }

  // â”€â”€ Click on a valid destination â”€â”€
  if (selectedCell) {
    const vm = validMoves.find(m => m.row === r && m.col === c);
    if (vm) {
      if (vm.type === 'capture') executeCapture(selectedCell.row, selectedCell.col, vm);
      else                       executeSimpleMove(selectedCell.row, selectedCell.col, r, c);
      return;
    }
  }

  // â”€â”€ Select a piece â”€â”€
  const piece = board[r][c];
  if (piece && piece.color === myColor) {
    if (forcedCaptures.length) {
      const fc = forcedCaptures.find(f => f.r === r && f.c === c);
      if (!fc) { pushSystemMsg('âš  Must capture with a highlighted piece!'); return; }
      selectedCell = { row: r, col: c };
      validMoves   = movesFromPaths(fc.paths);
    } else {
      selectedCell = { row: r, col: c };
      validMoves   = getSimpleMoves(r, c);
    }
  } else {
    selectedCell = null;
    validMoves   = [];
  }

  renderBoard();
  updateStatus();
}

function executeSimpleMove(fr, fc, tr, tc) {
  const hadForced = forcedCaptures.length > 0;
  const p = board[fr][fc];
  board[tr][tc] = p;
  board[fr][fc] = null;

  // Promotion
  if ((p.color === 'white' && tr === 0) || (p.color === 'black' && tr === 7))
    board[tr][tc].king = true;

  const huffable = hadForced ? { row: tr, col: tc } : null;
  selectedCell = null;
  validMoves   = [];
  pushStateToFirebase(board, oppColor(), huffable);
}

function executeCapture(fr, fc, move) {
  const p = board[fr][fc];
  board[move.capturedFirst.r][move.capturedFirst.c] = null;
  board[fr][fc]       = null;
  board[move.row][move.col] = p;

  // Promotion
  if ((p.color === 'white' && move.row === 0) || (p.color === 'black' && move.row === 7))
    board[move.row][move.col].king = true;

  // Check chain
  const further = bestCapturePaths(move.row, move.col);
  if (further.length) {
    chainCapture   = { row: move.row, col: move.col };
    selectedCell   = { row: move.row, col: move.col };
    forcedCaptures = [{ r: move.row, c: move.col, paths: further, maxCaptures: further[0].length }];
    validMoves     = movesFromPaths(further);
    renderBoard();
    updateStatus();
    pushStateChain(board, myColor);
  } else {
    chainCapture = null;
    selectedCell = null;
    validMoves   = [];
    pushStateToFirebase(board, oppColor(), null);
  }
}

function oppColor() { return myColor === 'white' ? 'black' : 'white'; }

/* â”€â”€ HUFF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.doHuff = function() {
  if (!huffablePiece || currentTurn !== myColor) return;
  board[huffablePiece.row][huffablePiece.col] = null;
  pushSystemMsg(`âš¡ ${myName} huffed a piece!`);
  huffablePiece = null;
  pushStateHuff(board, myColor);
};

window.addEmoji = function(e) {
  const ta = document.getElementById('chat-input');
  ta.value += e;
  ta.focus();
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIN CHECK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function checkWinner(b, nextTurn) {
  // Count pieces
  let cnt = 0;
  for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++)
    if (b[r][c]?.color === nextTurn) cnt++;
  if (!cnt) return nextTurn === 'white' ? 'black' : 'white';

  // Any legal move?
  for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++) {
    if (b[r][c]?.color === nextTurn) {
      if (getSimpleMoves(r, c, b).length > 0) return null;
      if (bestCapturePaths(r, c, b).length > 0) return null;
    }
  }
  return nextTurn === 'white' ? 'black' : 'white';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE STATE PUSH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const b2f = b => b.map(row => row.map(c => c || null));
const f2b = fb => fb.map(row => row.map(c => c || null));

async function pushStateToFirebase(b, next, huff) {
  if (!gameRef) return;
  const winner = checkWinner(b, next);
  await set(ref(db, `games/${gameId}/state`), {
    board:          b2f(b),
    current_turn:   next,
    huffable_piece: huff || null,
    chain_capture:  null,
    last_move:      Date.now(),
    winner:         winner || null
  });
}

async function pushStateChain(b, same) {
  if (!gameRef) return;
  await set(ref(db, `games/${gameId}/state`), {
    board:          b2f(b),
    current_turn:   same,
    huffable_piece: null,
    chain_capture:  chainCapture,
    last_move:      Date.now(),
    winner:         null
  });
}

async function pushStateHuff(b, same) {
  if (!gameRef) return;
  await set(ref(db, `games/${gameId}/state`), {
    board:          b2f(b),
    current_turn:   same,
    huffable_piece: null,
    chain_capture:  null,
    last_move:      Date.now(),
    winner:         null
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE LISTENER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function applyState(state, players) {
  board         = f2b(state.board);
  currentTurn   = state.current_turn;
  huffablePiece = state.huffable_piece || null;
  chainCapture  = state.chain_capture  || null;

  if (currentTurn === myColor && !chainCapture) {
    forcedCaptures = computeForcedCaptures(myColor);
    selectedCell   = null;
    validMoves     = [];
  } else if (chainCapture && currentTurn === myColor) {
    const fc = bestCapturePaths(chainCapture.row, chainCapture.col);
    forcedCaptures = fc.length
      ? [{ r: chainCapture.row, c: chainCapture.col, paths: fc, maxCaptures: fc[0].length }]
      : [];
    if (fc.length) {
      selectedCell = { row: chainCapture.row, col: chainCapture.col };
      validMoves   = movesFromPaths(fc);
    }
  } else {
    forcedCaptures = [];
  }

  if (state.winner) {
    gameOver = true;
    showWinModal(state.winner, players);
  }

  if (players) {
    document.getElementById('name-white').textContent = players.white?.name || 'White';
    document.getElementById('name-black').textContent = players.black?.name || 'Black';
  }

  renderBoard();
  updateStatus();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOBBY â€” create / join
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.createGame = async function() {
  myName   = document.getElementById('player-name').value.trim() || 'Player 1';
  myColor  = 'white';
  gameId   = generateRoomId();
  gameRef  = ref(db, `games/${gameId}`);
  chatRef  = ref(db, `games/${gameId}/chat`);
  initBoard();

  await set(gameRef, {
    players: { white: { name: myName } },
    state: {
      board:          b2f(board),
      current_turn:   'white',
      huffable_piece: null,
      chain_capture:  null,
      last_move:      Date.now(),
      winner:         null
    },
    created: serverTimestamp()
  });

  document.getElementById('display-game-id').textContent = gameId;
  document.getElementById('room-id-chip').textContent    = gameId;
  window._currentRoomId = gameId;
  showScreen('waiting');

  // Wait for opponent
  unsubGame = onValue(gameRef, snap => {
    const d = snap.val();
    if (d?.players?.black && document.getElementById('waiting').classList.contains('active')) {
      launchGame(d);
    }
  });
};

window.joinGame = async function() {
  const rawId = document.getElementById('join-game-id').value.trim().toUpperCase();
  if (!rawId) { alert('Please enter a Room ID'); return; }

  myName   = document.getElementById('player-name').value.trim() || 'Player 2';
  myColor  = 'black';
  gameId   = rawId;
  gameRef  = ref(db, `games/${gameId}`);
  chatRef  = ref(db, `games/${gameId}/chat`);

  const snap = await get(gameRef);
  if (!snap.exists()) { alert('Game not found! Check the Room ID.'); return; }
  const d = snap.val();
  if (d.players?.black) { alert('This game is already full!'); return; }

  await set(ref(db, `games/${gameId}/players/black`), { name: myName });
  document.getElementById('room-id-chip').textContent = gameId;
  window._currentRoomId = gameId;
  launchGame(d);
};

function launchGame(initialData) {
  if (unsubGame) { unsubGame(); unsubGame = null; }
  showScreen('game');

  if (initialData.state) applyState(initialData.state, initialData.players);

  // Real-time sync
  unsubGame = onValue(gameRef, snap => {
    const d = snap.val();
    if (!d) return;
    if (d.state) applyState(d.state, d.players);
  });

  // Chat sync
  if (unsubChat) { unsubChat(); unsubChat = null; }
  unsubChat = onValue(chatRef, snap => {
    const msgs = snap.val();
    const container = document.getElementById('chat-messages');
    container.innerHTML = '';
    if (msgs) {
      Object.values(msgs)
        .sort((a, b) => a.ts - b.ts)
        .forEach(m => renderChatMsg(m));
    }
    container.scrollTop = container.scrollHeight;
  });

  // Welcome message
  push(chatRef, {
    sender: 'System',
    text: `ğŸ® Game started! You play as ${myColor === 'white' ? 'White (á€–á€¼á€°)' : 'Black (á€™á€Šá€ºá€¸)'}. ${myColor === 'white' ? 'White moves first.' : 'Good luck!'}`,
    ts: Date.now(),
    system: true
  });
}

/* â”€â”€ CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.sendChat = async function() {
  const ta   = document.getElementById('chat-input');
  const text = ta.value.trim();
  if (!text || !chatRef) return;
  ta.value = '';
  await push(chatRef, { sender: myName, text, ts: Date.now(), system: false });
};

function renderChatMsg(m) {
  const container = document.getElementById('chat-messages');
  const wrap      = document.createElement('div');
  wrap.className  = 'chat-message'
    + (m.system              ? ' is-system' : '')
    + (!m.system && m.sender === myName ? ' is-mine' : '');

  const bubble = document.createElement('div');
  bubble.className = 'chat-bubble';

  if (!m.system) {
    const sender = document.createElement('div');
    sender.className   = 'chat-sender';
    sender.textContent = m.sender;
    bubble.appendChild(sender);
  }

  const text = document.createElement('div');
  text.className   = 'chat-text';
  text.textContent = m.text;
  bubble.appendChild(text);

  if (!m.system) {
    const ts = document.createElement('div');
    ts.className   = 'chat-time';
    ts.textContent = new Date(m.ts).toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
    bubble.appendChild(ts);
  }

  wrap.appendChild(bubble);
  container.appendChild(wrap);
  container.scrollTop = container.scrollHeight;
}

function pushSystemMsg(text) {
  if (chatRef) push(chatRef, { sender: 'System', text, ts: Date.now(), system: true });
}

/* â”€â”€ WIN MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showWinModal(winner, players) {
  const isMe    = winner === myColor;
  const wName   = winner === 'white'
    ? (players?.white?.name || 'White')
    : (players?.black?.name || 'Black');

  document.getElementById('win-medal').textContent    = isMe ? 'ğŸ†' : 'ğŸ’€';
  document.getElementById('win-title').textContent    = isMe ? 'VICTORY!' : 'DEFEAT';
  document.getElementById('win-subtitle').textContent = isMe
    ? `${wName} conquers the board!`
    : `${wName} wins this round.`;

  document.getElementById('win-overlay').classList.add('active');
}

/* â”€â”€ BACK TO LOBBY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.backToLobby = function() {
  if (unsubGame) { unsubGame(); unsubGame = null; }
  if (unsubChat) { unsubChat(); unsubChat = null; }
  gameId = myColor = null;
  gameOver = false;
  selectedCell = null; validMoves = [];
  chainCapture = null; huffablePiece = null;
  forcedCaptures = []; prevCounts = { white:12, black:12 };
  document.getElementById('win-overlay').classList.remove('active');
  showScreen('lobby');
};

/* â”€â”€ COPY ROOM ID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.copyGameId = function() {
  const id = window._currentRoomId || gameId;
  if (!id) return;
  navigator.clipboard.writeText(id).then(() => {
    ['display-game-id', 'room-id-chip'].forEach(elId => {
      const el = document.getElementById(elId);
      if (!el) return;
      const prev = el.textContent;
      el.textContent = 'COPIED!';
      setTimeout(() => { el.textContent = prev; }, 1500);
    });
  }).catch(() => {});
};

/* â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(name).classList.add('active');
}

function generateRoomId() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  return Array.from({ length: 6 }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
}

/* â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
initBoard();
renderBoard();
updatePips();

</script>
</body>
</html>
